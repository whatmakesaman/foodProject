<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‚´ ë¬¸ì˜ ëª©ë¡</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/form-style.css') }}">
</head>
<body>
  <!-- ìƒë‹¨ ë„¤ë¹„ -->
  <div class="top-nav">
    <div class="nav-left">
      <div class="form-icon">
        <strong>ğŸ“„</strong>
      </div>
      <div class="form-title-group">
        <div class="form-title-text">ë‚´ ë¬¸ì˜ ëª©ë¡</div>
      </div>
    </div>

    <div class="nav-center"></div>

    <div class="nav-right">
      <button class="publish-btn" id="write-inquiry-btn">ë¬¸ì˜ ì‘ì„±</button>
      <button class="publish-btn" id="to-ranking-btn" style="margin-left:8px;">ë­í‚¹ ë³´ê¸°</button>
      <div class="profile-icon">U</div>
    </div>
  </div>

  <div class="main-content">
    <div class="tab-menu">
      <button class="tab-btn" id="rank-tab">ë­í‚¹</button>
      <button class="tab-btn active">ë¬¸ì˜</button>
    </div>

    <div class="form-container">
      <!-- ì„¤ëª… ì¹´ë“œ -->
      <div class="form-card">
        <div class="form-header">
          <input
            class="form-title-input"
            type="text"
            value="ë‚´ê°€ ì‘ì„±í•œ ë¬¸ì˜ë“¤"
            readonly
          />
          <div class="form-description">
            <input
              class="form-description-input"
              type="text"
              value="ìµœê·¼ ìˆœìœ¼ë¡œ ë‚´ê°€ ë‚¨ê¸´ ë¬¸ì˜ ë‚´ì—­ì…ë‹ˆë‹¤."
              readonly
            />
          </div>
        </div>
      </div>

      <!-- ì—¬ê¸° ì•ˆì— ë¬¸ì˜ ì¹´ë“œë“¤ì´ ë“¤ì–´ê° -->
      <div id="inquiry-list"></div>

      <!-- ë©”ì‹œì§€ ì˜ì—­ -->
      <div id="list-message" style="margin-top: 12px; color: #5f6368;"></div>
    </div>
  </div>

  <script>
    // ==== ê³µí†µ ìš”ì†Œ ====
    const listEl = document.getElementById("inquiry-list");
    const msgEl = document.getElementById("list-message");

    // ë¡œê·¸ì¸ í† í° ê°€ì ¸ì˜¤ê¸°
    const token = localStorage.getItem("token");

    if (!token) {
      alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      window.location.href = "/login.html";
    }

    // íƒ­/ë²„íŠ¼ ë„¤ë¹„ê²Œì´ì…˜
    document.getElementById("rank-tab").addEventListener("click", () => {
      window.location.href = "/ranking";   // â˜… Flask ë¼ìš°íŠ¸
    });

    document.getElementById("write-inquiry-btn").addEventListener("click", () => {
      window.location.href = "/inquiry";   // â˜… Flask ë¼ìš°íŠ¸
    });

    document.getElementById("to-ranking-btn").addEventListener("click", () => {
      window.location.href = "/ranking";   // â˜… Flask ë¼ìš°íŠ¸
    });

    // ==== ë‚´ ë¬¸ì˜ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ====
    async function loadInquiries() {
      msgEl.style.color = "#5f6368";
      msgEl.textContent = "ë¬¸ì˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
      listEl.innerHTML = "";

      try {
        const res = await fetch("/api/inquiries", {   // â˜… user_id ì¿¼ë¦¬ ì•ˆ ì”€, í† í° ê¸°ë°˜
          method: "GET",
          headers: {
            "Authorization": "Bearer " + token
          }
        });

        const data = await res.json().catch(() => ([]));

        if (!res.ok) {
          msgEl.style.color = "#d93025";
          msgEl.textContent = (data.error || data.message || "ë¬¸ì˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          return;
        }

        if (!Array.isArray(data) || data.length === 0) {
          msgEl.textContent = "ì‘ì„±í•œ ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        msgEl.textContent = "";

        data.forEach((inq) => {
          const card = document.createElement("div");
          card.className = "question-card";

          const answered = inq.answer && inq.answer.trim().length > 0;

          card.innerHTML = `
            <div class="question-content">
              <div class="question-header">
                <div class="question-title-input" style="border-bottom:none;">
                  [${answered ? "ë‹µë³€ ì™„ë£Œ" : "ë‹µë³€ ëŒ€ê¸°"}] ${inq.title || "(ì œëª© ì—†ìŒ)"}
                </div>
              </div>
              <div class="question-options">
                <div class="option-item">
                  <span>ì‘ì„±ì¼: ${inq.created_at || ""}</span>
                </div>
                <div class="option-item">
                  <span>ë¶„ì•¼: ${inq.field || "-"}</span>
                </div>
                <div class="option-item">
                  <span>ë‚´ìš©: ${inq.content || ""}</span>
                </div>
                <div class="option-item">
                  <span>ë‹µë³€: ${answered ? inq.answer : "ì•„ì§ ë‹µë³€ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."}</span>
                </div>
                <div class="option-item">
                  <button class="publish-btn"
                          onclick="location.href='/inquiry_detail?id=${inq.inquiry_id}'">
                    ìƒì„¸ ë³´ê¸°
                  </button>
                </div>
              </div>
            </div>
          `;

          listEl.appendChild(card);
        });

      } catch (err) {
        console.error(err);
        msgEl.style.color = "#d93025";
        msgEl.textContent = "ë¬¸ì˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    }

    loadInquiries();
  </script>
</body>
</html>
