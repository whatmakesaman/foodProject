<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì „ì²´ ë¬¸ì˜ ê´€ë¦¬</title>
  <link rel="stylesheet" href="form-style.css">
</head>
<body>
  <!-- ìƒë‹¨ ë„¤ë¹„ -->
  <div class="top-nav">
    <div class="nav-left">
      <div class="form-icon"><strong>ğŸ“„</strong></div>
      <div class="form-title-group">
        <div class="form-title-text">ì „ì²´ ë¬¸ì˜ ê´€ë¦¬</div>
      </div>
    </div>

    <div class="nav-center"></div>

    <div class="nav-right">
      <button class="publish-btn" onclick="location.href='ranking.html'">ë­í‚¹ ë³´ê¸°</button>
      <div class="profile-icon">A</div>
    </div>
  </div>

  <div class="main-content">
    <div class="tab-menu">
      <button class="tab-btn" onclick="location.href='ranking.html'">ë­í‚¹</button>
      <button class="tab-btn active">ë¬¸ì˜</button>
    </div>

    <div class="form-container">
      <div class="form-card">
        <div class="form-header">
          <input class="form-title-input" type="text"
                 value="ì „ì²´ ì‚¬ìš©ì ë¬¸ì˜ ëª©ë¡" readonly />
          <div class="form-description">
            <input class="form-description-input" type="text"
                   value="ë‹µë³€ì´ í•„ìš”í•œ ë¬¸ì˜ë¥¼ ì„ íƒí•´ ë‹µë³€ì„ ì‘ì„±í•˜ì„¸ìš”." readonly />
          </div>
        </div>
      </div>

      <div id="admin-inquiry-list"></div>
      <div id="admin-msg" style="margin-top:12px; color:#5f6368;"></div>
    </div>
  </div>

  <script>
    const LIST_API_URL = "http://localhost:5000/api/inquiries_all"; // ì•„ë˜ì—ì„œ ë¼ìš°íŠ¸ ë§Œë“¤ë©´ ë¨

    const listEl = document.getElementById("admin-inquiry-list");
    const msgEl = document.getElementById("admin-msg");

    async function loadAllInquiries() {
      msgEl.textContent = "ë¬¸ì˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
      listEl.innerHTML = "";

      try {
        const res = await fetch(LIST_API_URL);
        const data = await res.json();

        if (!Array.isArray(data) || data.length === 0) {
          msgEl.textContent = "ë“±ë¡ëœ ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        msgEl.textContent = "";

        data.forEach(inq => {
          const card = document.createElement("div");
          card.className = "question-card";

          const answered = inq.answer && inq.answer.trim().length > 0;

          card.innerHTML = `
            <div class="question-content">
              <div class="question-header">
                <div class="question-title-input" style="border-bottom:none;">
                  [${answered ? "ë‹µë³€ ì™„ë£Œ" : "ë‹µë³€ ëŒ€ê¸°"}] ${inq.title || "(ì œëª© ì—†ìŒ)"}
                </div>
              </div>
              <div class="question-options">
                <div class="option-item">
                  <span>ì‘ì„±ì: ${inq.writer || "-"}</span>
                </div>
                <div class="option-item">
                  <span>ì‘ì„±ì¼: ${inq.created_at || ""}</span>
                </div>
                <div class="option-item">
                  <span>ë¶„ì•¼: ${inq.field || "-"}</span>
                </div>
                <div class="option-item">
                  <button class="publish-btn"
                          onclick="location.href='admin_answer.html?id=${inq.inquiry_id}'">
                    ë‹µë³€ ì‘ì„± / ìˆ˜ì •
                  </button>
                </div>
              </div>
            </div>
          `;

          listEl.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        msgEl.style.color = "#d93025";
        msgEl.textContent = "ë¬¸ì˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    }

    loadAllInquiries();
  </script>
</body>
</html>
