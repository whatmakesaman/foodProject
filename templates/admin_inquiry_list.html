<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì „ì²´ ë¬¸ì˜ ëª©ë¡</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/form-style.css') }}" />
  <style>
    .styled-table {
      border-collapse: collapse;
      width: 100%;
      background-color: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .styled-table thead {
      background-color: #f5f5f5;
    }
    
    .styled-table th {
      font-weight: 600;
      color: #202124;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .styled-table tbody tr:hover {
      background-color: #f9f9f9;
    }
    
    .styled-table tbody tr:last-child td {
      border-bottom: none;
    }
  </style>
</head>
<body>

  <!-- ìƒë‹¨ ë„¤ë¹„ -->
  <div class="top-nav">
    <div class="nav-left">
      <div class="form-icon"><strong>ğŸ“„</strong></div>
      <div class="form-title-group">
        <div class="form-title-text">ì „ì²´ ë¬¸ì˜ ê´€ë¦¬</div>
      </div>
    </div>

    <div class="nav-center"></div>

    <div class="nav-right">
      <button class="publish-btn" id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>

  <div class="main-content">
    <div class="tab-menu">
      <button class="tab-btn" onclick="location.href='/admin/store/search'">ë§¤ì¥ ê²€ìƒ‰</button>
      <button class="tab-btn active">ë¬¸ì˜</button>
    </div>

    <div class="form-container">
      <div class="form-card">
        <div class="form-header">
          <h3 style="margin-bottom: 20px;">ì „ì²´ ë¬¸ì˜ ëª©ë¡</h3>
        </div>

        <div style="overflow-x: auto;">
          <table class="styled-table" style="width: 100%; border-collapse: collapse; table-layout: fixed;">
            <thead>
              <tr>
                <th style="width: 8%; text-align: center; padding: 12px 8px;">ë²ˆí˜¸</th>
                <th style="width: 35%; text-align: left; padding: 12px 8px;">ì œëª©</th>
                <th style="width: 12%; text-align: center; padding: 12px 8px;">ì‘ì„±ì</th>
                <th style="width: 10%; text-align: center; padding: 12px 8px;">ë¶„ì•¼</th>
                <th style="width: 20%; text-align: center; padding: 12px 8px;">ì‘ì„±ì¼</th>
                <th style="width: 15%; text-align: center; padding: 12px 8px;">ë‹µë³€</th>
              </tr>
            </thead>
            <tbody id="inquiry-table-body">
              <!-- JSê°€ ì—¬ê¸°ë‹¤ê°€ í–‰ ì¶”ê°€í•¨ -->
            </tbody>
          </table>
        </div>

        <div id="msg" style="margin-top: 12px; color: #5f6368;"></div>
      </div>
    </div>
  </div>

<script>
async function loadInquiries() {
  const API = "http://localhost:5000/api/inquiries_all";

  try {
    const res = await fetch(API);
    const data = await res.json();

    if (!Array.isArray(data)) {
      msg.textContent = "ëª©ë¡ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
      return;
    }

    const tbody = document.getElementById("inquiry-table-body");
    tbody.innerHTML = "";

    data.forEach(row => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td style="text-align: center; padding: 12px 8px; border-bottom: 1px solid #e0e0e0;">${row.inquiry_id}</td>
        <td style="text-align: left; padding: 12px 8px; border-bottom: 1px solid #e0e0e0;">
          <a href="/admin_inquiry_detail?id=${row.inquiry_id}" 
             style="cursor:pointer; color:#1a73e8; text-decoration: none; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
             onmouseover="this.style.textDecoration='underline'"
             onmouseout="this.style.textDecoration='none'">
            ${row.title || "-"}
          </a>
        </td>
        <td style="text-align: center; padding: 12px 8px; border-bottom: 1px solid #e0e0e0;">${row.writer || "-"}</td>
        <td style="text-align: center; padding: 12px 8px; border-bottom: 1px solid #e0e0e0;">${row.field || "-"}</td>
        <td style="text-align: center; padding: 12px 8px; border-bottom: 1px solid #e0e0e0;">${row.created_at || "-"}</td>
        <td style="text-align: center; padding: 12px 8px; border-bottom: 1px solid #e0e0e0;">
          <span style="padding: 4px 8px; border-radius: 4px; font-size: 13px; ${row.answer ? 'background-color: #e8f5e9; color: #2e7d32;' : 'background-color: #fff3e0; color: #e65100;'}">
            ${row.answer ? "ì™„ë£Œ" : "ëŒ€ê¸°"}
          </span>
        </td>
      `;

      tbody.appendChild(tr);
    });

  } catch (err) {
    console.error(err);
    document.getElementById("msg").textContent = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
  }
}

// í˜ì´ì§€ ë¡œë“œì‹œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
loadInquiries();

// ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
function logout() {
  if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    // localStorageì—ì„œ ëª¨ë“  ì¸ì¦ ì •ë³´ ì œê±°
    localStorage.removeItem("token");
    localStorage.removeItem("user_id");
    localStorage.removeItem("user_name");
    localStorage.removeItem("isAdmin");
    localStorage.removeItem("adminId");
    localStorage.removeItem("admin_name");
    localStorage.removeItem("adminName");
    
    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
    window.location.href = "/login";
  }
}

// ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œê·¸ì•„ì›ƒ
document.getElementById("logout-btn").addEventListener("click", logout);
</script>

</body>
</html>
