<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë§›ì§‘ ë­í‚¹</title>

 

<link rel="stylesheet" href="{{ url_for('static', filename='css/form-style.css') }}">
</head>
<body>
  <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
  <div class="top-nav">
    <div class="nav-left">
      <div class="form-icon">
        <!-- ì•„ì´ì½˜ ëŒ€ì‹  í…ìŠ¤íŠ¸ -->
        <strong>ğŸ½ï¸</strong>
      </div>
      <div class="form-title-group">
        <div class="form-title-text">ë§›ì§‘ ë­í‚¹</div>
      </div>
    </div>

    <div class="nav-center">
      <!-- í•„ìš”í•˜ë©´ ë‚˜ì¤‘ì— ë²„íŠ¼/ì•„ì´ì½˜ ì¶”ê°€ -->
    </div>

    <div class="nav-right">
      <button class="publish-btn" id="refresh-btn">ë­í‚¹ ìƒˆë¡œê³ ì¹¨</button>
      <button class="more-btn">â‹®</button>
      <div class="profile-icon">U</div>
    </div>
  </div>

  <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
  <div class="main-content">
    <!-- íƒ­ ë©”ë‰´ (ë­í‚¹ / ë¬¸ì˜ / ê¸°íƒ€â€¦) í•„ìš”í•˜ë©´ í™•ì¥ -->
    <div class="tab-menu">
      <button class="tab-btn active">ë­í‚¹</button>
      <button class="tab-btn" id="inquiry-tab">ë¬¸ì˜</button>
    </div>

    <!-- í¼ ì»¨í…Œì´ë„ˆ -->
    <div class="form-container">
      <!-- ìƒë‹¨ ì„¤ëª… ì¹´ë“œ -->
      <div class="form-card">
        <div class="form-header">
          <input
            class="form-title-input"
            type="text"
            value="ë§›ì§‘ ë­í‚¹ ê²°ê³¼"
            readonly
          />
          <div class="form-description">
            <input
              class="form-description-input"
              type="text"
              value="ì‚¬ìš©ì ë¦¬ë·°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ëœ ë² ì´ì§€ì•ˆ ì ìˆ˜ ìˆœ ë­í‚¹ì…ë‹ˆë‹¤."
              readonly
            />
          </div>
        </div>
      </div>

      <!-- ë­í‚¹ ì¹´ë“œë“¤ì´ ë“¤ì–´ê°ˆ ì˜ì—­ -->
      <div id="rank-list">
        <!-- JSì—ì„œ question-cardë“¤ì„ ìƒì„±í•´ì„œ ë„£ì–´ì¤„ ì˜ˆì • -->
      </div>

      <!-- ë¡œë”© ë©”ì‹œì§€ / ì—ëŸ¬ ë©”ì‹œì§€ -->
      <div id="rank-loading" style="margin-top: 12px; color: #5f6368;">
        ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
      </div>
      <div id="rank-error" style="margin-top: 12px; color: #d93025; display: none;">
        ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
      </div>
    </div>
  </div>

  <script>
    const API_URL = "http://localhost:5000/api/rank?limit=20&use_adv=1";

    const rankListEl = document.getElementById("rank-list");
    const loadingEl = document.getElementById("rank-loading");
    const errorEl = document.getElementById("rank-error");
    const refreshBtn = document.getElementById("refresh-btn");

    async function loadRanking() {
      loadingEl.style.display = "block";
      errorEl.style.display = "none";
      rankListEl.innerHTML = "";

      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        loadingEl.style.display = "none";

        if (!Array.isArray(data) || data.length === 0) {
          rankListEl.innerHTML =
            '<div style="margin-top: 8px; color:#5f6368;">í‘œì‹œí•  ë­í‚¹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        data.forEach((store, index) => {
          const card = document.createElement("div");
          card.className = "question-card";

          card.innerHTML = `
            <div class="question-content">
              <div class="question-header">
                <div class="question-title-input" style="border-bottom:none;">
                  ${index + 1}ìœ„ Â· ${store.name || "ì´ë¦„ ì—†ìŒ"}
                </div>
              </div>

              <div class="question-options">
                <div class="option-item">
                  <span>í‰ê·  í‰ì : <strong>${Number(store.avg_rating).toFixed(2)}</strong></span>
                </div>
                <div class="option-item">
                  <span>ë¦¬ë·° ìˆ˜: <strong>${store.review_cnt}</strong>ê°œ</span>
                </div>
                <div class="option-item">
                  <span>ë­í‚¹ ì ìˆ˜: <strong>${Number(store.score).toFixed(3)}</strong></span>
                </div>
                <div class="option-item">
                  <span>ê±°ë¦¬: <strong>${store.distance_km}</strong> km</span>
                </div>
              </div>
            </div>
          `;
data.forEach((store, index) => {
  const card = document.createElement("div");
  card.className = "question-card";

  card.innerHTML = `
    <div class="question-content">
      <div class="question-header">
        <div class="question-title-input" style="border-bottom:none;">
          ${index + 1}ìœ„ Â· ${store.name || "ì´ë¦„ ì—†ìŒ"}
        </div>
      </div>

      <div class="question-options">
        <div class="option-item">
          <span>í‰ê·  í‰ì : <strong>${Number(store.avg_rating).toFixed(2)}</strong></span>
        </div>
        <div class="option-item">
          <span>ë¦¬ë·° ìˆ˜: <strong>${store.review_cnt}</strong>ê°œ</span>
        </div>
        <div class="option-item">
          <span>ë­í‚¹ ì ìˆ˜: <strong>${Number(store.score).toFixed(3)}</strong></span>
        </div>
        <div class="option-item">
          <span>ê±°ë¦¬: <strong>${store.distance_km}</strong> km</span>
        </div>

        <!-- â­ ì—¬ê¸° ì¶”ê°€: ìƒì„¸ë³´ê¸° ë²„íŠ¼ -->
        <div class="option-item">
          <button class="publish-btn" onclick="location.href='/ranking/store_info/${store.store_id}'">
            ë©”ë‰´ / ìƒì„¸ ë³´ê¸°
          </button>
        </div>
      </div>
    </div>
  `;

  rankListEl.appendChild(card);
});

          rankListEl.appendChild(card);
        });
      } catch (err) {
        console.error("ë­í‚¹ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
        loadingEl.style.display = "none";
        errorEl.style.display = "block";
      }
    }

    // í˜ì´ì§€ ì²˜ìŒ ë¡œë“œ ì‹œ
    loadRanking();

    // ìƒë‹¨ "ë­í‚¹ ìƒˆë¡œê³ ì¹¨" ë²„íŠ¼
    refreshBtn.addEventListener("click", () => {
      loadRanking();
    });
  </script>
  <script>
  document.getElementById("inquiry-tab").addEventListener("click", () => {
    window.location.href = "inquiry";
  });
</script>

</body>
</html>
